<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- jQuery( JavaScript 라이브러리 ) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <title>Title</title>

</head>
<body>
    <h1 th:if="${session.loginUser}">로그인됨 : [[${session.loginUser.userName}]]</h1>

    <div class="container">
        <div class="row">
            <div class="col-5">
                왜안되냐
            <div>
            <div class="col-4">
                나도 모름
            <div>
        </div>
    </div>
    <hr>
    <h3>회원 추가</h3>
    <form action="/v01/user" method="post">
        <input type="text" name="userName"> <button type="submit">일반 회원</button>
    </form>
    <form action="/v01/mentor" method="post">
        <input type="text" name="userName"> <button type="submit">멘토</button>
    </form>
    <hr>
    <h2>유저 목록</h2>
    <table>
        <tr>
            <th>이름</th>
            <th></th>
            <th>역할</th>
            <th>단톡방 개설</th>
        </tr>
        <tr th:each="user: ${userList}">
            <td>
                <button class="loginBtn" th:data-user-id="${user.uid}">[[${user.userName}]]</button>
            </td>
            <td> ~~ </td>
            <td th:text="${user.role}"></td>
            <td>
                <div th:if="${user.role.name() == 'MENTOR'}">
                    <input type="text" class="roomName" placeholder="단톡방 이름">
                    <input type="text" class="userLimit" placeholder="인원 제한">
                    <button class="createRoom">단톡방 생성</button>
                </div>
            </td>
        </tr>
    </table>

    <form action="/v01/chr" method="get">
        <input th:if="${session?.loginUser}" type="hidden" name="uid" class="userId" th:value="${session.loginUser?.uid}">
        <input th:if="${session?.loginUser == null}" type="hidden" name="uid" class="userId" >
        <button type="submit">단톡방 입장</button>
    </form>
    <hr>
    <h2>단톡방 목록</h2>
 </body>
<script>

    $(".loginBtn").on("click", function() {
        var userId = $(this).data("user-id");

        $.ajax({
            type:"get",
            url:"/v01/api/login/" + userId,
            success:function(response) {
                $(".userId").val(userId);
            },
            error:function(xhr) {
                let response = xhr.responseJSON;
                console.log(response);
                alert("로그인 실패 \n" + response.message);
            }
        });
    });

    $(".createRoom").on("click", function() {
        var mId = $(this).data("user-id");

        var params = {
                        "roomName": $(".roomName").val(), "userLimit": $(".userLimit").val()
                      }

        $.ajax({
            type:"post",
            url:"/v01/api/room/" + mId,
            data: params,
            success:function(response) {

            },
            error:function(xhr) {
                let response = xhr.responseJSON;
                console.log(response);
                alert("로그인 실패 \n" + response.message);
            }
        });
    });


</script>
</html>